{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nexport function normalizeStyle(style) {\n  if (!style) {\n    return null;\n  }\n\n  if (typeof style === 'string') {\n    return style;\n  }\n\n  if (style.toJS) {\n    style = style.toJS();\n  }\n\n  var layerIndex = style.layers.reduce(function (accum, current) {\n    return Object.assign(accum, _defineProperty({}, current.id, current));\n  }, {});\n  style.layers = style.layers.map(function (layer) {\n    layer = Object.assign({}, layer);\n    delete layer.interactive;\n    var layerRef = layerIndex[layer.ref];\n\n    if (layerRef) {\n      delete layer.ref;\n\n      if (layerRef.type !== undefined) {\n        layer.type = layerRef.type;\n      }\n\n      if (layerRef.source !== undefined) {\n        layer.source = layerRef.source;\n      }\n\n      if (layerRef['source-layer'] !== undefined) {\n        layer['source-layer'] = layerRef['source-layer'];\n      }\n\n      if (layerRef.minzoom !== undefined) {\n        layer.minzoom = layerRef.minzoom;\n      }\n\n      if (layerRef.maxzoom !== undefined) {\n        layer.maxzoom = layerRef.maxzoom;\n      }\n\n      if (layerRef.filter !== undefined) {\n        layer.filter = layerRef.filter;\n      }\n\n      if (layerRef.layout !== undefined) {\n        layer.layout = layer.layout || {};\n        layer.layout = Object.assign({}, layer.layout, layerRef.layout);\n      }\n    }\n\n    return layer;\n  });\n  return style;\n}","map":{"version":3,"sources":["../../../src/utils/style-utils.js"],"names":["style","layerIndex","Object","current","layer","layerRef"],"mappings":";AAWA,OAAO,SAAA,cAAA,CAAA,KAAA,EAA2D;AAChE,MAAI,CAAJ,KAAA,EAAY;AACV,WAAA,IAAA;AACD;;AACD,MAAI,OAAA,KAAA,KAAJ,QAAA,EAA+B;AAC7B,WAAA,KAAA;AACD;;AACD,MAAIA,KAAK,CAAT,IAAA,EAAgB;AACdA,IAAAA,KAAK,GAAGA,KAAK,CAAbA,IAAQA,EAARA;AACD;;AACD,MAAMC,UAAU,GAAG,KAAK,CAAL,MAAA,CAAA,MAAA,CACjB,UAAA,KAAA,EAAA,OAAA,EAAA;AAAA,WAAoBC,MAAM,CAANA,MAAAA,CAAAA,KAAAA,EAAAA,eAAAA,CAAAA,EAAAA,EAAuBC,OAAO,CAA9BD,EAAAA,EAApB,OAAoBA,CAAAA,CAApB;AADiB,GAAA,EAAnB,EAAmB,CAAnB;AAKAF,EAAAA,KAAK,CAALA,MAAAA,GAAe,KAAK,CAAL,MAAA,CAAA,GAAA,CAAiB,UAAA,KAAA,EAAS;AACvCI,IAAAA,KAAK,GAAGF,MAAM,CAANA,MAAAA,CAAAA,EAAAA,EAARE,KAAQF,CAARE;AAGA,WAAOA,KAAK,CAAZ,WAAA;AAEA,QAAMC,QAAQ,GAAGJ,UAAU,CAACG,KAAK,CAAjC,GAA2B,CAA3B;;AAEA,QAAA,QAAA,EAAc;AACZ,aAAOA,KAAK,CAAZ,GAAA;;AACA,UAAIC,QAAQ,CAARA,IAAAA,KAAJ,SAAA,EAAiC;AAC/BD,QAAAA,KAAK,CAALA,IAAAA,GAAaC,QAAQ,CAArBD,IAAAA;AACD;;AACD,UAAIC,QAAQ,CAARA,MAAAA,KAAJ,SAAA,EAAmC;AACjCD,QAAAA,KAAK,CAALA,MAAAA,GAAeC,QAAQ,CAAvBD,MAAAA;AACD;;AACD,UAAIC,QAAQ,CAARA,cAAQ,CAARA,KAAJ,SAAA,EAA4C;AAC1CD,QAAAA,KAAK,CAALA,cAAK,CAALA,GAAwBC,QAAQ,CAAhCD,cAAgC,CAAhCA;AACD;;AACD,UAAIC,QAAQ,CAARA,OAAAA,KAAJ,SAAA,EAAoC;AAClCD,QAAAA,KAAK,CAALA,OAAAA,GAAgBC,QAAQ,CAAxBD,OAAAA;AACD;;AACD,UAAIC,QAAQ,CAARA,OAAAA,KAAJ,SAAA,EAAoC;AAClCD,QAAAA,KAAK,CAALA,OAAAA,GAAgBC,QAAQ,CAAxBD,OAAAA;AACD;;AACD,UAAIC,QAAQ,CAARA,MAAAA,KAAJ,SAAA,EAAmC;AACjCD,QAAAA,KAAK,CAALA,MAAAA,GAAeC,QAAQ,CAAvBD,MAAAA;AACD;;AACD,UAAIC,QAAQ,CAARA,MAAAA,KAAJ,SAAA,EAAmC;AACjCD,QAAAA,KAAK,CAALA,MAAAA,GAAeA,KAAK,CAALA,MAAAA,IAAfA,EAAAA;AACAA,QAAAA,KAAK,CAALA,MAAAA,GAAeF,MAAM,CAANA,MAAAA,CAAAA,EAAAA,EAAkBE,KAAK,CAAvBF,MAAAA,EAAgCG,QAAQ,CAAvDD,MAAeF,CAAfE;AACD;AACF;;AACD,WAAA,KAAA;AAjCFJ,GAAe,CAAfA;AAoCA,SAAA,KAAA;AACD","sourcesContent":["// @flow\ntype MapboxStyle =\n  | string\n  | {\n      toJS?: Function,\n      layers: Array<any>\n    };\n\n// Prepare a map style object for diffing\n// If immutable - convert to plain object\n// Work around some issues in the styles that would fail Mapbox's diffing\nexport function normalizeStyle(style: ?MapboxStyle): ?MapboxStyle {\n  if (!style) {\n    return null;\n  }\n  if (typeof style === 'string') {\n    return style;\n  }\n  if (style.toJS) {\n    style = style.toJS();\n  }\n  const layerIndex = style.layers.reduce(\n    (accum, current) => Object.assign(accum, {[current.id]: current}),\n    {}\n  );\n\n  style.layers = style.layers.map(layer => {\n    layer = Object.assign({}, layer);\n\n    // Breaks style diffing :(\n    delete layer.interactive;\n\n    const layerRef = layerIndex[layer.ref];\n    // Style diffing doesn't work with refs so expand them out manually before diffing.\n    if (layerRef) {\n      delete layer.ref;\n      if (layerRef.type !== undefined) {\n        layer.type = layerRef.type;\n      }\n      if (layerRef.source !== undefined) {\n        layer.source = layerRef.source;\n      }\n      if (layerRef['source-layer'] !== undefined) {\n        layer['source-layer'] = layerRef['source-layer'];\n      }\n      if (layerRef.minzoom !== undefined) {\n        layer.minzoom = layerRef.minzoom;\n      }\n      if (layerRef.maxzoom !== undefined) {\n        layer.maxzoom = layerRef.maxzoom;\n      }\n      if (layerRef.filter !== undefined) {\n        layer.filter = layerRef.filter;\n      }\n      if (layerRef.layout !== undefined) {\n        layer.layout = layer.layout || {};\n        layer.layout = Object.assign({}, layer.layout, layerRef.layout);\n      }\n    }\n    return layer;\n  });\n\n  return style;\n}\n"]},"metadata":{},"sourceType":"module"}